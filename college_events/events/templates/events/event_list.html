{% extends 'events/base.html' %}
{% load static %}

{% block title %}Upcoming Events ‚Äî CollegeEvents{% endblock %}
{% block meta_description %}Browse and register for upcoming college events.{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
    /* Inline styles from original event_list ‚Äî ticket modal etc */
    .ticket {
        background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
        padding: 15px;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, .1);
        position: relative;
        overflow: hidden;
        margin: 10px auto;
        max-width: 500px;
        border: 1px solid #e9ecef;
        font-size: .9em;
    }

    .ticket-content {
        display: flex;
        justify-content: space-between;
        gap: 15px;
        position: relative;
    }

    .ticket-left {
        flex: 2;
        padding-right: 15px;
    }

    .ticket-right {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        border-left: 2px dashed #6366f1;
        padding-left: 15px;
        position: relative;
    }

    .qr-code {
        margin-bottom: 10px;
        padding: 5px;
        background: #fff;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, .05);
        width: 100px;
        height: 100px;
    }

    .qr-code img {
        width: 100%;
        height: 100%;
    }

    .ticket-id {
        text-align: center;
        font-size: .8em;
        color: #6c757d;
        font-weight: 600;
        letter-spacing: .5px;
    }

    .details {
        margin-top: 12px;
    }

    .details-section {
        margin-bottom: 8px;
        padding: 8px;
        background: rgba(255, 255, 255, .8);
        border-radius: 6px;
    }

    .details-section h4 {
        color: #6366f1;
        margin-bottom: 5px;
        font-size: .95em;
        font-weight: 600;
    }

    .details-section p {
        margin-bottom: 3px;
        font-size: .85em;
        color: #495057;
    }

    .details-section i {
        margin-right: 6px;
        width: 12px;
        text-align: center;
        color: #6366f1;
    }

    .corner-circles {
        position: absolute;
        width: 20px;
        height: 20px;
        background: #f8f9fa;
        border: 1px solid #6366f1;
        border-radius: 50%;
        z-index: 1;
    }

    .corner-circle-top {
        top: -10px;
        left: 50%;
        transform: translateX(-50%);
    }

    .corner-circle-bottom {
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
    }

    /* Filter tabs */
    .filter-bar {
        background: #fff;
        border-radius: 20px;
        padding: 20px 28px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, .07);
        margin-bottom: 40px;
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .filter-tab {
        background: transparent;
        border: 2px solid #e2e8f0;
        border-radius: 50px;
        padding: 8px 22px;
        font-weight: 600;
        font-size: 14px;
        color: #64748b;
        cursor: pointer;
        transition: all 0.25s;
    }

    .filter-tab:hover,
    .filter-tab.active {
        background: linear-gradient(135deg, #6366f1, #ec4899);
        border-color: transparent;
        color: #fff;
    }

    #eventSearch {
        flex: 1;
        min-width: 220px;
        border: 2px solid #e2e8f0;
        border-radius: 50px;
        padding: 10px 22px;
        font-size: 15px;
        font-family: 'Inter', sans-serif;
        color: #0f172a;
        outline: none;
        transition: border-color 0.2s;
    }

    #eventSearch:focus {
        border-color: #6366f1;
    }

    .empty-state {
        text-align: center;
        padding: 80px 20px;
    }

    .empty-state i {
        font-size: 64px;
        color: #e2e8f0;
        margin-bottom: 20px;
        display: block;
    }

    .empty-state h4 {
        color: #64748b;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .empty-state p {
        color: #94a3b8;
        font-size: 15px;
    }

    /* Tiered Dark-Mode Overrides for event_list.html */
    html[data-theme="dark"] .filter-bar,
    html[data-theme="midnight"] .filter-bar,
    html[data-theme="forest"] .filter-bar {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(12px);
    }

    html[data-theme="dark"] #eventSearch,
    html[data-theme="midnight"] #eventSearch,
    html[data-theme="forest"] #eventSearch {
        background: #0f172a;
        color: #f1f5f9;
        border-color: rgba(99, 102, 241, 0.25);
    }

    html[data-theme="dark"] #eventSearch::placeholder,
    html[data-theme="midnight"] #eventSearch::placeholder,
    html[data-theme="forest"] #eventSearch::placeholder {
        color: #64748b;
    }

    html[data-theme="dark"] .empty-state h4,
    html[data-theme="midnight"] .empty-state h4,
    html[data-theme="forest"] .empty-state h4 {
        color: #f1f5f9;
    }

    html[data-theme="dark"] .skeleton-loader-bg,
    html[data-theme="midnight"] .skeleton-loader-bg,
    html[data-theme="forest"] .skeleton-loader-bg {
        background: #1e293b !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, .2) !important;
    }

    /* ‚îÄ‚îÄ Polished Calendar UI Adjustments ‚îÄ‚îÄ */
    #calendar-wrapper {
        display: none;
        background: #fff;
        padding: 30px;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.05);
    }

    /* Global Calendar Font & Links */
    .fc {
        font-family: 'Inter', sans-serif !important;
    }

    .fc a {
        color: inherit !important;
        text-decoration: none !important;
        transition: color 0.2s;
    }

    .fc a:hover {
        color: #6366f1 !important;
    }

    /* Header Toolbar Typography */
    .fc .fc-toolbar-title {
        font-weight: 800 !important;
        font-family: 'Outfit', sans-serif !important;
        color: #1e293b;
        font-size: 1.5rem !important;
    }

    /* Premium Buttons */
    .fc .fc-button-primary {
        background: #fff !important;
        border: 2px solid #e2e8f0 !important;
        color: #64748b !important;
        border-radius: 50px !important;
        padding: 6px 18px !important;
        font-weight: 600 !important;
        text-transform: capitalize !important;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        box-shadow: none !important;
        margin: 0 4px !important;
    }

    .fc .fc-button-primary:not(:disabled):hover,
    .fc .fc-button-primary:not(:disabled).fc-button-active {
        background: linear-gradient(135deg, #6366f1, #ec4899) !important;
        color: #fff !important;
        border-color: transparent !important;
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3) !important;
    }

    /* Borders and Grid */
    .fc-theme-standard td,
    .fc-theme-standard th {
        border-color: #e2e8f0 !important;
    }

    .fc-col-header-cell {
        padding: 10px 0 !important;
        background: rgba(248, 250, 252, 0.5);
    }

    /* Today Highlight (Light Mode) */
    .fc .fc-day-today {
        background: rgba(99, 102, 241, 0.04) !important;
    }

    /* ‚îÄ‚îÄ Dark Mode Overrides for Calendar ‚îÄ‚îÄ */
    html[data-theme="dark"] #calendar-wrapper,
    html[data-theme="midnight"] #calendar-wrapper,
    html[data-theme="forest"] #calendar-wrapper {
        background: #1e293b;
        backdrop-filter: blur(12px);
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    }

    html[data-theme="dark"] .fc,
    html[data-theme="midnight"] .fc,
    html[data-theme="forest"] .fc {
        color: #f1f5f9;
    }

    html[data-theme="dark"] .fc .fc-toolbar-title,
    html[data-theme="midnight"] .fc .fc-toolbar-title,
    html[data-theme="forest"] .fc .fc-toolbar-title {
        color: #f1f5f9;
    }

    html[data-theme="dark"] .fc-theme-standard td,
    html[data-theme="dark"] .fc-theme-standard th,
    html[data-theme="midnight"] .fc-theme-standard td,
    html[data-theme="midnight"] .fc-theme-standard th,
    html[data-theme="forest"] .fc-theme-standard td,
    html[data-theme="forest"] .fc-theme-standard th {
        border-color: rgba(148, 163, 184, 0.1) !important;
    }

    html[data-theme="dark"] .fc-col-header-cell,
    html[data-theme="midnight"] .fc-col-header-cell,
    html[data-theme="forest"] .fc-col-header-cell {
        background: rgba(15, 23, 42, 0.5);
    }

    html[data-theme="dark"] .fc .fc-button-primary,
    html[data-theme="midnight"] .fc .fc-button-primary,
    html[data-theme="forest"] .fc .fc-button-primary {
        background: #0f172a !important;
        border-color: rgba(99, 102, 241, 0.25) !important;
        color: #94a3b8 !important;
    }

    /* Today Highlight (Dark Mode) - Removesa the muddy green/yellow default */
    html[data-theme="dark"] .fc .fc-day-today,
    html[data-theme="midnight"] .fc .fc-day-today,
    html[data-theme="forest"] .fc .fc-day-today {
        background: rgba(99, 102, 241, 0.1) !important;
    }
</style>
{% endblock %}

{% block content %}

<!-- Page Hero -->
<div class="page-hero">
    <div class="container" style="position:relative;z-index:2;">
        <h1 data-aos="fade-up"><i class="fas fa-calendar-alt mr-3"></i>Upcoming Events</h1>
        <p data-aos="fade-up" data-aos-delay="100">Register for exciting events happening at your college</p>
    </div>
</div>

<section style="padding: 60px 0 100px;">
    <div class="container">

        <!-- Search + Filter Bar -->
        <div class="filter-bar" data-aos="fade-up">
            <input type="text" id="eventSearch" placeholder="üîç  Search events by name or venue..." autocomplete="off">
            <button class="filter-tab active" data-filter="all">üåü All</button>
            <button class="filter-tab" data-filter="technical">üíª Technical</button>
            <button class="filter-tab" data-filter="cultural">üé≠ Cultural</button>
            <button class="filter-tab" data-filter="sports">‚öΩ Sports</button>
            <button class="filter-tab" data-filter="workshop">üõ†Ô∏è Workshop</button>

            <div style="flex:1"></div>
            <div class="d-flex" style="gap: 10px;">
                <button class="btn btn-sm text-white px-3 fw-bold" id="btn-list-view"
                    style="border-radius:20px; background:linear-gradient(135deg,#6366f1,#ec4899); border:none;"><i
                        class="fas fa-list mr-1"></i> List</button>
                <button class="btn btn-sm text-secondary px-3 fw-bold bg-white" id="btn-calendar-view"
                    style="border-radius:20px; border: 2px solid #e2e8f0; background:transparent;"><i
                        class="fas fa-calendar-alt mr-1"></i> Calendar</button>
            </div>
        </div>

        <!-- Event Grid -->
        <div class="row" id="event-list">
            <!-- Skeleton loaders -->
            {% for i in "123" %}
            <div class="col-md-4 mb-4 skeleton-wrapper">
                <div class="skeleton-loader-bg"
                    style="background:#fff;border-radius:24px;overflow:hidden;box-shadow:0 4px 20px rgba(0,0,0,.07);">
                    <div
                        style="height:220px;background:linear-gradient(90deg,#e2e8f0 25%,#f8fafc 50%,#e2e8f0 75%);background-size:400% 100%;animation:shimmer 1.5s infinite; opacity: 0.5;">
                    </div>
                    <div style="padding:24px;">
                        <div
                            style="height:20px;border-radius:8px;background:linear-gradient(90deg,#e2e8f0 25%,#f8fafc 50%,#e2e8f0 75%);background-size:400% 100%;animation:shimmer 1.5s infinite;margin-bottom:12px; opacity: 0.5;">
                        </div>
                        <div
                            style="height:14px;border-radius:8px;background:linear-gradient(90deg,#e2e8f0 25%,#f8fafc 50%,#e2e8f0 75%);background-size:400% 100%;animation:shimmer 1.5s infinite;width:70%;margin-bottom:8px; opacity: 0.5;">
                        </div>
                        <div
                            style="height:14px;border-radius:8px;background:linear-gradient(90deg,#e2e8f0 25%,#f8fafc 50%,#e2e8f0 75%);background-size:400% 100%;animation:shimmer 1.5s infinite;width:50%; opacity: 0.5;">
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Calendar View -->
        <div id="calendar-wrapper">
            <div id="calendar"></div>
        </div>

        <div id="no-events" class="empty-state" style="display:none;">
            <i class="fas fa-calendar-times"></i>
            <h4>No upcoming events found</h4>
            <p>Try a different search or check back later!</p>
            <a href="{% url 'completed_events' %}" class="btn mt-3"
                style="background:linear-gradient(135deg,#6366f1,#ec4899);color:#fff;border-radius:50px;padding:12px 32px;font-weight:700;">View
                Completed Events</a>
        </div>
    </div>
</section>

<!-- Registration Modal -->
<div class="modal fade" id="registrationModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="border-radius:24px; border:none; box-shadow:0 30px 80px rgba(0,0,0,.2);">
            <div class="modal-header"
                style="background:linear-gradient(135deg,#6366f1,#ec4899);border-radius:24px 24px 0 0;border:none;padding:24px 30px;">
                <h5 class="modal-title"
                    style="color:#fff;font-family:'Outfit',sans-serif;font-weight:700;font-size:20px;">
                    <i class="fas fa-ticket-alt mr-2"></i> Register for Event
                </h5>
                <button type="button" class="close" data-dismiss="modal"
                    style="color:#fff;opacity:1;"><span>&times;</span></button>
            </div>
            <div class="modal-body" style="padding:30px;">
                <form id="registrationForm" onsubmit="submitRegistration(event)">
                    {% csrf_token %}
                    <input type="hidden" id="selectedEventId" name="eventId">
                    <div class="form-group">
                        <label style="font-weight:600;color:#1e293b;">Full Name</label>
                        <input type="text" class="form-control" name="name" id="studentName"
                            placeholder="Enter your full name"
                            style="border-radius:12px;border:2px solid #e2e8f0;padding:12px 16px;" required>
                    </div>
                    <div class="form-group">
                        <label style="font-weight:600;color:#1e293b;">Email Address</label>
                        <input type="email" class="form-control" name="email" id="reg_email"
                            placeholder="your@email.com"
                            style="border-radius:12px;border:2px solid #e2e8f0;padding:12px 16px;" required
                            autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label style="font-weight:600;color:#1e293b;">Course</label>
                        <select class="form-control" name="course" id="course"
                            style="border-radius:12px;border:2px solid #e2e8f0;padding:10px 16px;height:auto;min-height:48px;line-height:1.5;"
                            required>
                            <option value="">Select Course</option>
                            <option value="B.Tech">B.Tech</option>
                            <option value="M.Tech">M.Tech</option>
                            <option value="BCA">BCA</option>
                            <option value="MCA">MCA</option>
                            <option value="BSc">BSc</option>
                            <option value="MBA">MBA</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="font-weight:600;color:#1e293b;">Branch</label>
                        <select class="form-control" name="branch" id="branch"
                            style="border-radius:12px;border:2px solid #e2e8f0;padding:10px 16px;height:auto;min-height:48px;line-height:1.5;"
                            required>
                            <option value="">Select Branch</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Information Technology">Information Technology</option>
                            <option value="Electronics">Electronics</option>
                            <option value="Mechanical">Mechanical</option>
                            <option value="Civil">Civil</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label style="font-weight:600;color:#1e293b;">Mobile Number</label>
                        <input type="tel" class="form-control" name="mobile" id="mobile"
                            placeholder="10-digit mobile number" pattern="[0-9]{10}" maxlength="10"
                            style="border-radius:12px;border:2px solid #e2e8f0;padding:12px 16px;" required>
                        <small class="form-text text-muted">Enter your 10-digit mobile number</small>
                    </div>
                    <div id="registrationError" class="alert alert-danger d-none" style="border-radius:12px;"></div>
                    <div class="modal-footer" style="border:none;padding:0;padding-top:20px;">
                        <button type="button" class="btn" data-dismiss="modal"
                            style="border-radius:50px;border:2px solid #e2e8f0;padding:10px 24px;font-weight:600;color:#64748b;">Cancel</button>
                        <button type="submit" class="btn"
                            style="background:linear-gradient(135deg,#6366f1,#ec4899);color:#fff;border-radius:50px;padding:10px 30px;font-weight:700;border:none;">
                            <i class="fas fa-check mr-1"></i> Register Now
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Ticket Modal -->
<div class="modal fade" id="ticketModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content" style="border-radius:24px;border:none;box-shadow:0 30px 80px rgba(0,0,0,.2);">
            <div class="modal-header"
                style="background:linear-gradient(135deg,#6366f1,#ec4899);border-radius:24px 24px 0 0;border:none;padding:24px 30px;">
                <h5 class="modal-title"
                    style="color:#fff;font-family:'Outfit',sans-serif;font-weight:700;font-size:20px;">
                    üéüÔ∏è Your Event Ticket
                </h5>
                <button type="button" class="close" data-dismiss="modal"
                    style="color:#fff;opacity:1;"><span>&times;</span></button>
            </div>
            <div class="modal-body" style="padding:30px;">
                <div id="ticketPreview"></div>
            </div>
            <div class="modal-footer" style="border:none;padding:20px 30px 30px;">
                <button type="button" class="btn" data-dismiss="modal"
                    style="border-radius:50px;border:2px solid #e2e8f0;padding:10px 24px;font-weight:600;color:#64748b;">Close</button>
                <button type="button" class="btn" onclick="downloadTicket()"
                    style="background:linear-gradient(135deg,#6366f1,#ec4899);color:#fff;border-radius:50px;padding:10px 30px;font-weight:700;border:none;">
                    <i class="fas fa-download mr-1"></i> Download Ticket
                </button>
            </div>
        </div>
    </div>
</div>
</div>

{% if request.user.is_staff %}
<!-- ‚ïê‚ïê Admin Edit Event Modal ‚ïê‚ïê -->
<div class="modal fade premium-modal" id="eventModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="premium-modal-header">
                <h5 class="premium-modal-title" id="eventModalLabel">
                    <i class="fas fa-edit" style="color:#6366f1;"></i> Update Event
                </h5>
                <button type="button" class="close" data-dismiss="modal" style="font-size:32px;">&times;</button>
            </div>
            <div class="premium-modal-body">
                <form id="eventForm">
                    <input type="hidden" id="eventId">
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="premium-label">Event Name</label>
                            <input type="text" class="form-control premium-input" id="eventName" required
                                placeholder="Enter event title">
                        </div>
                        <div class="col-md-6 mb-4">
                            <label class="premium-label">Venue</label>
                            <input type="text" class="form-control premium-input" id="eventVenue" required
                                placeholder="Location name">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="premium-label">Description</label>
                        <textarea class="form-control premium-input" id="eventDescription" rows="4" required
                            placeholder="Briefly describe the event..."></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-4">
                            <label class="premium-label">Date</label>
                            <input type="date" class="form-control premium-input" id="eventDate" required>
                        </div>
                        <div class="col-md-6 mb-4">
                            <label class="premium-label">Image URL</label>
                            <input type="url" class="form-control premium-input" id="eventImage" required
                                placeholder="https://unsplash.com/...">
                        </div>
                    </div>
                </form>
            </div>
            <div class="premium-modal-footer">
                <button type="button" class="btn btn-cancel-premium" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-save-premium" onclick="saveEvent()">Save Changes</button>
            </div>
        </div>
    </div>
</div>
{% endif %}

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script>
    (function () { emailjs.init("d61RjZppg7Ssz025r"); })();
</script>
<style>
    @keyframes shimmer {
        0% {
            background-position: 200% 0
        }

        100% {
            background-position: -200% 0
        }
    }
</style>
<script src="{% static 'events/script.js' %}?v=12"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
<script>
    // Calendar implementation
    let calendar;
    const btnList = document.getElementById('btn-list-view');
    const btnCal = document.getElementById('btn-calendar-view');
    const eventListDiv = document.getElementById('event-list');
    const calWrapper = document.getElementById('calendar-wrapper');

    btnList.addEventListener('click', function () {
        btnList.style.background = 'linear-gradient(135deg,#6366f1,#ec4899)';
        btnList.style.color = '#fff';
        btnList.style.border = 'none';

        btnCal.style.background = 'transparent';
        btnCal.style.color = '#64748b';
        btnCal.style.border = '2px solid #e2e8f0';

        eventListDiv.style.display = 'flex';
        calWrapper.style.display = 'none';
    });

    btnCal.addEventListener('click', function () {
        btnCal.style.background = 'linear-gradient(135deg,#6366f1,#ec4899)';
        btnCal.style.color = '#fff';
        btnCal.style.border = 'none';

        btnList.style.background = 'transparent';
        btnList.style.color = '#64748b';
        btnList.style.border = '2px solid #e2e8f0';

        eventListDiv.style.display = 'none';
        calWrapper.style.display = 'block';

        if (!calendar) {
            const calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek'
                },
                themeSystem: 'standard',
                events: function (info, successCallback, failureCallback) {
                    if (window._allEvents) {
                        const calEvents = window._allEvents.map(e => ({
                            id: e.id,
                            title: e.name,
                            start: e.date + (e.time ? 'T' + e.time : ''),
                            url: '#', // prevents navigation
                            backgroundColor: '#6366f1',
                            borderColor: '#8b5cf6',
                            extendedProps: e
                        }));
                        successCallback(calEvents);
                    } else {
                        successCallback([]);
                    }
                },
                eventContent: function (arg) {
                    return { html: `<div style="padding:3px;font-size:12px;font-weight:bold;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;">‚ú® ${arg.event.title}</div>` };
                },
                eventClick: function (info) {
                    info.jsEvent.preventDefault();
                    const e = info.event.extendedProps;

                    const registerBtn = document.querySelector(`.btn-register-premium[data-event-id="${e.id}"]`);
                    if (registerBtn) {
                        registerBtn.click();
                    } else {
                        Swal.fire({
                            title: e.name,
                            html: `<b>üìÖ ${e.date}</b><br><b>üìç ${e.venue}</b><br><br>${e.description}`,
                            confirmButtonColor: '#6366f1'
                        });
                    }
                }
            });
            calendar.render();
        } else {
            calendar.render();
        }
    });
</script>
<script>
    // Filter tabs
    document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.addEventListener('click', function () {
            document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
        });
    });

    // Ticket download
    function downloadTicket() {
        const el = document.querySelector('#ticketPreview');
        if (!el) return;
        html2canvas(el).then(canvas => {
            const link = document.createElement('a');
            link.download = 'event-ticket.png';
            link.href = canvas.toDataURL('image/png');
            link.click();
        });
    }
</script>
{% endblock %}